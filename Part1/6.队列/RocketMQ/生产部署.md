## 参数调整

从网络IO、CPU负载（线程数量）、内存占用、磁盘IO这几个方面来考虑

#### OS内核参数

- vm.overcommit_memory（内存相关）

  0，1，2三个值，设置为1，允许分配所有可用物理内存

- vm.swappiness（内存相关）

  调小一点，尽量使用物理内存，别放磁盘swap区域

- vm.max_map_count（CPU、线程相关）

  开启线程数量，默认65536，建议调大10倍

- ulimit -a（网络连接、磁盘文件打开相关）

  调整最大打开文件数，设置大点
  
  

#### JVM参数

bin目录下的runbroker.sh脚本

- 堆内存大小
- 垃圾回收器相关（G1）
- 可申请direct buffer大小

根据机器内存调整



#### MQ自身参数

sendMessageThreadPoolNums

MQ内部用来发送消息的线程池线程数量，默认16，可设置比CPU核心数稍大点







## 压测

开大量线程并发读写消息

压测期间观察机器这几个指标

- CPU负载

  top命令

- 内存使用率

  free命令

- GC频率

  jstat命令

- 磁盘IO

  top命令，观察磁盘IO等待与CPU执行时间百分比，数值高则表明IO负载高，CPU大部分时间在等待IO

- 网络带宽占用

需要在MQ的TPS和机器各种资源使用率之间做平衡，尽可能提高TPS，且保证高性能和稳定运行的同时不宕机

当以上任何参数负载达到瓶颈时，则代表整个机器的最适合的最高负载