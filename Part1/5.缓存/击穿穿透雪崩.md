## 缓存击穿

对于热点key可以设置永不过期

或者缓存过期时使用分布式锁去查DB刷新缓存（分布式锁保证只有一个线程查DB，防止把DB打挂）









## 缓存雪崩

#### 过程

多级缓存架构下

Redis集群挂了，导致缓存服务大量的请求hang在等待访问Redis集群上，资源被耗尽

缓存服务把请求全部转到业务系统去访问DB，导致DB被高并发打死，业务系统也hang住大量的请求等待DB响应，资源被耗尽，服务不可用

缓存服务的请求也hang在等待业务系统的响应，资源被耗尽，缓存服务不可用

导致Nginx本地缓存过期之后无法从缓存服务和业务系统获取数据，整个系统对外不可用



#### 事前

主从 + 双机房部署

#### 事中

做好缓存服务对Redis访问的资源隔离熔断降级（可以做熔断半开策略，自动恢复），保持缓存服务不要挂，还可以从缓存服务的本地缓存（ehcache）中获取一部分数据

也要做好对业务系统的隔离熔断降级

#### 事后

重启Redis，从备份的持久化文件恢复数据

若Redis数据彻底丢失或数据过旧，就先不要启动业务系统，给Redis做个缓存预热，把最新最热的数据放进去再重启