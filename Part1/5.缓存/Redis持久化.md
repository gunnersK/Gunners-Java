## 含义

- Redis读写都在内存，一旦进程退出会导致数据丢失，所以可以使用持久化的方式解决重启后数据恢复的问题

## 策略

##### RDB（快照方式：Redis Database）

- 把当前进程数据生成快照保存到硬盘的过程，分为手动触发和自动触发两种

##### AOF（文件追加方式：Append Only File）

- 记录所有的操作命令，并以文本的形式追加到文件中

##### 混合持久化

- Redis 4.0 之后新增的，结合了 RDB 和 AOF 的优点，在写入的时候，先把当前的数据以 RDB 的形式写入文件的开头，再将后续的操作命令以 AOF 的格式存入文件，这样既能保证 Redis 重启时的速度，又能减低数据丢失的风险。

## RDB（默认启动）

- 将某一个时刻的内存快照（Snapshot），以二进制的方式写入磁盘的过程

- 持久化方式有两种：手动触发和自动触发

- 手动触发

	- ```save```命令：阻塞主线程，必须等到RDB持久化完成之后，才会相应客户端的命令，所以**线上环境不建议使用**
	- ```bgsave```命令：Redis进程首先执行fork操作创建子进程，RDB持久化过程由子进程负责，完成后自动结束。阻塞只发生在fork阶段，一般时间很短，基本不会发生阻塞
	
- 自动触发

  - ```save m n```：表示m秒内有n个key修改时，自动触发`bgsave`命令

  - 在redis.conf配置文件配置

    ```shell
    save 900 1
    save 300 10
    save 60 10000
    ```