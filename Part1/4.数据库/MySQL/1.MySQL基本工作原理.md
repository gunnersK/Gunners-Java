## 数据库连接

程序需要使用**数据库驱动**与DB建立网络连接，才能发送请求给DB服务器，对DB进行操作







## 应用程序数据库连接池

程序本身会维护一个DB**连接池**，程序中每个线程会从连接池中获取连接去使用，用完归还。这样可以避免程序多个线程**争抢一个连接**，或者每个线程都**频繁建立与销毁**数据库连接，降低开销

常见的数据库连接池有DBCP, C3P0, Druid等







## MySQL数据库连接池

MySQL本身也要维护一个连接池与应用程序系统之间建立多个连接

MySQL每次跟应用程序建立连接时，会验证传递过来的账号密码，进行库表权限验证







## 数据更新过程

更新某条记录时，**执行器**配合**InnoDB**存储引擎完成一个SQL语句在磁盘和内存层面的全部数据更新操作

步骤如下：

- 先到**InnoDB缓冲池（Buffer Pool）**中找这条记录，没有就从磁盘加载到BP中，且对这行记录加独占锁
- 把原记录的值写入Undo Log中，方便回滚还原数据
- 更新BP中记录的数据，此时数据就成为脏数据
- 将对内存所做的修改，写入内存的Redo Log Buffer中，用来MySQL宕机时的数据恢复
- 提交事务
  - BinLog日志刷盘
  - 根据策略把Redo日志从Redo Log Buffer写进磁盘







## RedoLog

Redo Log是偏向物理性质的重做日志，InnoDB引擎特有



#### RedoLog刷盘策略

通过innodb_flush_log_at_trx_commit配置刷盘策略，有0、1、2三个值

- 值为0时，提交事务**不会**把Redo Log从Buffer刷进磁盘，MySQL宕机数据就没了，**性能最高，数据安全最低**
- 值为1时，提交事务**必须**把Redo Log从Buffer刷进磁盘，MySQL宕机了也可以从Redo Log恢复数据，**性能最低，数据安全最高**
- 值为2时，提交事务把Redo Log写进OS Cache，等待OS刷进磁盘，就有可能会丢失Redo Log



#### 刷盘策略选择

对于DB这样严格的系统，一般建议Redo日志刷盘策略设置为1，保证事务提交之后数据绝对不能丢失







## BinLog日志

偏向逻辑性的归档日志，是MySQL自己的日志文件

sync_binlog参数配置策略