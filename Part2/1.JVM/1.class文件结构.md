- Java是跨平台语言，JVM跟Java无关，只跟class文件有关，JVM不看语言，任何语言只要能编译为class文件就可以放到JVM执行，所以JVM是跨语言平台
- JVM是一种规范，本身就是一款操作系统，有各种实现，hotspot(oracal官方实现)、TaobaoVM(hotspot深度定制版)
- JVM < JRE < JDK  
- 每种文件开头都会有特定标识，class文件开头是CA FE BA BE

## class文件结构

- magic：CA FE BA BE
- minor version：class文件的版本号：00 00
- major version：class文件的版本号：00 34
- constant_pool_count：常量池长度
- constant_pool：长度为constant_pool_count - 1的表
- 观察字节码的方法 
  - javap类文件路径(Java自带命令)
  - idea插件：jclasslib
- **对class文件做过深入研究，了解class文件详细信息**
- 常量池关键在于后面的东西都是去引用他的







## 常量池

#### class文件常量池

存放字面量和符号引用

字面量 -- 相当于Java语言层面常量的概念，如文本字符串，final类型常量值

符号引用 -- 属于编译原理的概念，包括：类和接口全限定名、字段&方法名及其描述符

存放的是**编译期**生成的东西，类加载时进入方法区的运行时常量池存放



#### 运行时常量池

class文件常量池预先保存好的常量在运行时存放到这里

存放运行时新生成的常量

`常量池具体干嘛的还是没搞懂`







## 如何理解字节码

Java源文件是给人看的，计算机识别不了，所以需要把Java文件编译为class文件

class文件中有一条条指令，JVM加载class文件，识别这些指令，进而对OS发出各种指令来执行程序

而且JVM跟Java语言不是强相关的，JVM只认识字节码，任何语言只要能编译为字节码，就可以放在JVM上面运行







## 字节码加密

如果不对字节码做任何加密操作，别人拿到class文件可以直接反编译为java源代码

所以可以对字节码进行加密操作，然后使用专门的类加载器加载到JVM中运行，这块有商用的产品

#### 实现原理

个人理解：因为class文件中是一条条字节码指令，可以通过重写字节码指令，保存一个重写指令映射表，将重写的指令与原始字节码指令做一一对应

然后专门的类加载器，根据加密后字节码中的重写指令，到映射表中找到对应的原始字节码指令，加载到JVM中运行

