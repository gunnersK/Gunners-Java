## 数据库瓶颈优化

- SQL调优 -- 开启慢日志记录，explain分析，调优SQL，尽量走索引
- 避免连表操作，设计表时增加冗余字段
- 部署读写分离集群
- 加缓存
- 分库分表









## 主从复制

Slave节点有一个IO线程与Master建立TCP连接

Master有一个dump线程把增删改binlog日志通过这个TCP连接发送给Slave

Slave把接收到的binlog日志写入本地relay日志文件

Slave另一个线程把relay日志文件的增删改内容在自己DB上执行一遍，进行日志重做，同步Master的操作



#### 半同步复制

搭建主从复制架构一般都用半同步复制方式

Master写入数据，得保证binlog日志给到从库了才返回事务成功

否则当写入的binlog还没同步到Slave，Master就宕机了，Slave再切换为Master，数据就丢了

搭建方式：传统方式、gtid



#### 数据延迟

从库多线程并行复制数据 / 读请求强制走主库



#### HA

使用MHA







## 分库分表

按业务id分库分表

建立索引映射表，对索引进行分库分表，把索引拆分到对应各个库中

把数据同步到ES去做复杂搜索



