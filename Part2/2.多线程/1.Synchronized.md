- 字节码层面会用monitorenter和monitorexit两条指令代表加锁和释放锁

- 每个对象（包括class对象）都会关联一个monitor，monitor中有一个初始值为0的计数器

  一个线程要获取对象的锁，执行monitorenter指令时，需要先看monitor计数器是不是0，0就可以获取锁，然后计数器 +1

  而且支持重入，即当前线程第二次获取对象的锁，会把计数器+1，+2，+3....

  线程在代码段执行结束会对计数器 -1

  若其他线程判断到对象monitor的计数器大于0，则会阻塞等待获取锁

自旋锁10次，线程占cpu
10次之后升级重量级锁，向OS申请资源，线程进入等待状态
加锁代码执行时间短、等待线程少，用自旋锁
执行时间长，线程多，用系统锁