## 线程池参数

线程池刚创建时是没有线程的，只有一个任务队列

当有任务时，若线程池中的线程数小于核心线程数**corePoolSize**时，就会创建一个线程去指定任务

等于核心线程数时，任务就放入队列中等待线程执行

线程执行完不会被杀死，会从工作队列中取出任务来执行

若任务队列满了，会新建普通线程执行任务，执行完毕，若到达**keepAliveTime**时间后，队列中仍没任务执行，则销毁线程

若队列生产任务过快，导致线程数量达到最大线程数**maximumPoolSize**，则执行拒绝策略**rejectedExecutionHandler**







## fixThreadPool

workQueue是无界阻塞队列

corePoolSize == maximumPoolSize

若任务队列是无界队列，最大线程数maximumPoolSize就没有意义







## 线程池使用策略

一般用无界队列会多一点，但要根据业务负载来创建线程池：

- 一定时间内任务会很多，但不会无穷无尽的多，而且任务消费也快，不会压垮内存，可以用**无界队列**

- 一瞬间会有大量任务进入队列，并且可能会压垮内存，则使用**有界队列**，并调整maximumPoolSize



#### 自定义拒绝策略

若线程池无法执行更多的任务，可以自定义拒绝策略，把任务写进磁盘，等线程池负载降低了，专门启动一个线程读取磁盘中的任务，提交到线程池中执行



#### 线程突然宕机，队列中的请求咋办

宕机后队列中的请求肯定会丢失的

任务提交到队列前先把任务记在DB或缓存并设置状态，宕机重启后再重新执行，并修改状态，需要开启事务，保持数据一致性  



**深入了解下拒绝策略**

ry3-21



