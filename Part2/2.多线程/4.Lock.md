## AQS

#### 定义

AbstractQueuedSynchronizer  抽象队列同步器，基于模板模式的锁框架，供各种子类去实现

#### 原理

内部主要有state变量、等待队列、加锁线程变量

当锁被某个线程持有，state=1，修改state是CAS操作，加锁线程变量改成自己

当锁被释放，state=0，同时唤醒队头的线程

当线程尝试CAS修改state获取锁时，若获取不了，会把自己挂起，进入等待队列







## ReentrantLock

基于AQS实现

#### 非公平锁

当t1线程释放锁，唤醒队头t2线程，t2线程还没成功获取锁时，t3线程进来把锁抢了，t2线程只能再次进入队列等待，这是非公平锁

#### 公平锁

每个线程只能进入等待队列排队，直到被唤醒才能获取锁

ReentrantLock(boolean fair)带布尔值的构造函数可用来指定是否用公平锁