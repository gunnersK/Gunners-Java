## Linux进程性能指标

#### 进程分类

根据功能可分为两大类

- 系统进程 -- 执行内存资源分配和进程切换等管理工作，不受用户干预，root用户也不例外

- 用户进程

  通过执行用户程序、应用程序或内核之外的系统程序而产生的进程，可在用户的控制下运行或关闭

  用户进程又可分为交互进程、批处理进程和守护进程
  - 交互进程 -- shell终端启动的进程，需要与用户进行交互操作，可以运行于前后台
  - 批处理进程 -- 是一个进程集合，负责按顺序启动其他进程
  - 守护进程 -- 是一直运行的进程，随着系统启动而启动，在系统关闭时终止



#### 父子进程

##### 关系

父进程发起fork()系统调用，创建子进程，获得一个进程描述符，复制父进程的进程描述符给子进程

父进程管理子进程，子进程退出时，会发送信号告知父进程，之后父进程调用wait()系统调用，获取子进程状态（退出状态及其他信息），然后清除子进程所有数据结构和进程描述符，释放其系统资源，从内存中将其移除



##### 僵尸进程

从子进程终止，到父进程调用wait()系统调用这段时间，子进程处于僵尸进程状态

一般僵尸进程阶段很快就结束，当编程不合理等情况，父进程一直不调用wait()系统调用，就会使子进程一直处于僵尸进程状态，一直占用系统资源



##### 孤儿进程

如果子进程退出前父进程已经退出了，子进程就成为孤儿进程，需重新指定其他进程作为他的父进程（可以指定超级父进程），释放其占用的资源



##### 超级父进程

PID=1进程是Linux的，所有进程都是他的后代



#### 进程与线程

##### 关系

- 一个线程只能属于一个进程，一个进程可以有多个线程，至少有一个线程
- 进程作为资源分配的最小单位，资源是分配给进程的，同一进程的所有线程共享该进程的所有资源
- 真正在处理机上运行的是线程



##### 区别

- 调度：线程是调度和分配的基本单位，进程是拥有资源的基本单位
- 并发性：进程之间可以并发执行，同一个进程的多个线程之间也可并发执行
- 拥有资源：进程是拥有资源的一个独立单位，线程不拥有系统资源，但可以访问隶属于进程的资源
- 系统开销：在创建或撤消进程时，由于系统都要为之分配和回收资源，所以系统的开销明显大于创建或撤消线程时的开销



#### 进程优先级

进程的优先级，是决定进程在CPU中执行顺序的数字。优先级越高的进程被处理器执行的机会越大

进程优先级由动态优先级和静态优先级决定，根据进程的行为，内核使用启发式算法决定开启或关闭动态优先级

可以通过**nice级别**直接修改进程的静态优先级，拥有越高静态优先级的进程会获得更长的时间片

Linux支持的nice级别从19 （最低优先级）到20 （最高优先级） ，默认为0，只有root身份的用户才能把进程的nice级别调整为负数（让其具备较高优先级）



#### 进程的状态

- 运行状态 -- 进程正在CPU中执行，或者在运行队列（run queue）中等待运行
- 停止状态 -- 进程由于特定的信号（如SIGINT、SIGSTOP）而挂起就会处于这个状态，等待恢复信号，比如SINCONT
- 可中断的等待状态 -- 进程处于阻塞状态，一旦达到某种条件，就会变为运行态。同时该状态的进程也会由于接收到信号而被提前唤醒进入到运行态。
- 不可中断的等待状态 -- 与可中断的等待状态”含义基本类似，唯一不同的是处于这个状态的进程对信号不做响应。不中断的等待状态最典型的例子是进程等待磁盘IO操作
- 僵死状态 -- 也就是僵死进程，每个进程在结束后都会处于僵死状态，等待父进程调用进而释放资源，处于该状态的进程已经结束，但是它的父进程还没有释放其系统资源



#### top命令各指标解析

- Tasks
  - total -- 系统当前总进程数
  - running -- 正在运行进程数
  - sleeping -- 休眠状态进程数
  - stopped -- 停止状态进程数
  - zombie -- 僵尸进程数（重点关注，僵尸进程占用资源不释放）
- %CPU
  - us -- 用户进程占用CPU时间百分比
  - sy -- 系统进程占用CPU时间百分比
  - ni -- 用户空间改变过优先级的进程占用CPU时间百分比
  - id -- 空闲状态占用CPU时间百分比（通过这个观察CPU负载，数值很小表示CPU负载很大）
  - wa -- 等待输入输出占用CPU时间百分比

- 表头

  - PR -- 进程优先级
  - NI -- 进程优先级nice值（越小负数优先级越高）
  - VIRT -- 进程使用虚拟内存大小
  - RES -- 进程使用物理内存大小
  - SHR -- 进程使用共享内存大小
  - S -- 进程状态：S睡眠状态，R运行状态，D：不可中断睡眠状态，T：跟踪/停止状态，Z：僵死状态

  <img src=".\pic\top命令.jpg" style="zoom:80%; float:left" />









## Linux内存性能指标

#### 物理内存&虚拟内存

系统中进程数量很多，直接使用物理内存会不够用，所以用虚拟内存

虚拟内存地址会映射到物理内存地址，程序只能通过虚拟内存与物理内存交互

进程间的虚拟内存是独立隔离的

可以通过物理内存做到进程间数据共享

OS通过分段和分页来处理物理内存和虚拟内存之间的映射

2-3开始